From 4ef1ce1a6460831e0ffd44fc0491a62013e4219b Mon Sep 17 00:00:00 2001
From: William Horvath <william@horvath.blog>
Date: Mon, 16 Jun 2025 20:55:36 -0700
Subject: [PATCH] unpause stale audio glitch

---
 src/core/soloud_core_voiceops.cpp | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/src/core/soloud_core_voiceops.cpp b/src/core/soloud_core_voiceops.cpp
index 6a5d4af..03ce5cf 100644
--- a/src/core/soloud_core_voiceops.cpp
+++ b/src/core/soloud_core_voiceops.cpp
@@ -23,6 +23,7 @@ freely, subject to the following restrictions:
 */
 
 #include "soloud.h"
+#include <string.h>
 
 // Direct voice operations (no mutexes - called from other functions)
 
@@ -62,6 +63,12 @@ void Soloud::setVoicePause_internal(unsigned int aVoice, int aPause)
 		else
 		{
 			mVoice[aVoice]->mFlags &= ~AudioSourceInstance::PAUSED;
+
+			// clear resample buffer contents when unpausing to avoid playing stale audio data
+			for (unsigned int ch = 0; ch < mVoice[aVoice]->mChannels && ch < MAX_CHANNELS; ch++)
+			{
+				memset(mVoice[aVoice]->mResampleBuffer[ch], 0, mVoice[aVoice]->mResampleBufferFill * sizeof(float));
+			}
 		}
 	}
 }
-- 
2.49.0

